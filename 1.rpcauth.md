- [ ] อธิบายแบบ user password ก่อน (why we should set rpcuser and rpcpassword answer authentication when call rpc)
- [ ] แล้วบอกว่ามันเสี่ยงยังไง (password stay in plain text if anyone can open your bitcoin.conf they can see your password, or you use git,or backup your bitcoin.conf to cloud service, someone can see your password)
- [ ] แล้วทำไมควรใช้ auth (hashed password, if anyone can open you bitcoin.conf they can't see your password, they can see only hashed password must brute force to get your password)

- [ ] แล้วบอกวิธี generate auth
- [ ] connect sparrow wallet

## rpcuser and rpcpassword

### 1. Open your bitcoin.conf file

```bash
$ nano ~/.bitcoin/bitcoin.conf
```

### 2. Add rpcuser and rpcpassword to your bitcoin.conf file

```conf
rpcuser=<your_rpc_username>
rpcpassword=<your_rpc_password>
```

### 3. Save and exit (Ctrl + X, Y, Enter)

### 4. Restart bitcoind

```bash
$ sudo systemctl restart bitcoind.service
```

### 5. Check the status of bitcoind

```bash
$ sudo systemctl status bitcoind.service
```

### 6. Check the log file for any error

```bash
$ tail -f ~/.bitcoin/debug.log
```

### 7. Test connection

#### 7.1 in raspberry pi5

```bash
$ bitcoin-cli help getblockchaininfo
getblockchaininfo

Returns an object containing various state info regarding blockchain processing.

Result:
{                                         (json object)
    ...
}

Examples:
> bitcoin-cli getblockchaininfo
> curl --user myusername --data-binary '{"jsonrpc": "2.0", "id": "curltest", "method": "getblockchaininfo", "params": []}' -H 'content-type: application/json' http://127.0.0.1:8332/
```

change myusername to your rpcuser and rpcpassword

````bash

then use curl to test the connection

```bash
curl --user myusername --data-binary '{"jsonrpc": "2.0", "id": "curltest", "method": "getblockchaininfo", "params": []}' -H 'content-type: application/json' http://127.0.0.1:8332/
````

## rpcauthh

```conf
rpcauth=<username>:<hashed_password>
```

#### How to generate rpcauth

1. Go to [https://github.com/bitcoin/bitcoin/blob/master/share/rpcauth/rpcauth.py](https://github.com/bitcoin/bitcoin/blob/master/share/rpcauth/rpcauth.py)
2. click "Raw" button to get the raw python script
3. wget the script to your machine

```bash
$ wget https://raw.githubusercontent.com/bitcoin/bitcoin/refs/heads/master/share/rpcauth/rpcauth.py

# you should see rpcauth.py in your current directory
$ ls
Desktop  Documents  Downloads  rpcauth.py
```

4. run the script with your desired username and password

```bash
python3 rpcauth.py <your_username> <your_password>
```

```bash
$ python3 rpcauth.py test test
String to be appended to bitcoin.conf:
rpcauth=test:d4951c8a7434864791b284f1ab418eba$8ad6f178fdfa62f926cde43966ec1eadf6f3f5bb0afb5baed0b1dcbafba7f9d7
Your password:
test
```

5. Copy the output and paste it into your bitcoin.conf file

```conf
rpcauth=<username>:<hashed_password>
```

```conf
rpcauth=test:59404178f93dda796d92c472090a5262$e12eb787cf0eef56bc8589342cfdf428a361370403c031d51bf4c73fa6bb9bf3
```

#### After set rpcauth

1. After set rpcauth in bitcoin.conf, restart bitcoind

```bash
systemctl restart bitcoind.service
```

2. Check the status of bitcoind

```bash
systemctl status bitcoind.service
```

3. Check the log file for any error

```bash
tail -f /home/pi/.bitcoin/debug.log
```

#### Test connection after set rpcauth

1. in raspberry pi5

```bash
$ bitcoin-cli help getblockchaininfo
getblockchaininfo

Returns an object containing various state info regarding blockchain processing.

Result:
{
....
}
Examples:
> bitcoin-cli getblockchaininfo
> curl --user myusername --data-binary '{"jsonrpc": "2.0", "id": "curltest", "method": "getblockchaininfo", "params": []}' -H 'content-type: application/json' http://127.0.0.1:8332/

```

we can use curl to test the connection too

```bash
curl --user <username> --data-binary '{"jsonrpc": "2.0", "id": "curltest", "method": "getblockchaininfo", "params": []}' -H 'content-type: application/json' http://127.0.0.1:8332/
```

```bash
$ curl --user test --data-binary '{"jsonrpc": "2.0", "id": "curltest", "method": "getblockchaininfo", "params": []}' -H 'content-type: application/json' http://127.0.0.1:8332/
Enter host password for user 'test':
{"jsonrpc":"2.0","result":{"chain":"main","blocks":915753,"headers":915753,"bestblockhash":"000000000000000000011aaa8e85e4831815b6f18340ef2d56ea3884a6301b30","bits":"1701fa38","target":"00000000000000000001fa380000000000000000000000000000000000000000","difficulty":142342602928674.9,"time":1758470427,"mediantime":1758466112,"verificationprogress":0.999993927355762,"initialblockdownload":false,"chainwork":"0000000000000000000000000000000000000000e4b2f04f4c9fb655ba731930","size_on_disk":783353282429,"pruned":false,"warnings":[]},"id":"curltest"}
```

2. test from your computer

find your raspberry pi ip address

```bash
$ ping raspberrypi.local
PING raspberrypi.local (192.168.0.112): 56 data bytes
64 bytes from 192.168.0.112: icmp_seq=0 ttl=64 time=61.313 ms # 192.168.0.112 is my raspberry pi ip address
64 bytes from 192.168.0.112: icmp_seq=1 ttl=64 time=13.027 ms

--- raspberrypi.local ping statistics ---
2 packets transmitted, 2 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 13.027/37.170/61.313/24.143 ms
```

> [!NOTE]
> ping use to find the ip address of your raspberry pi

run curl command from your computer

```bash
curl --user <username> --data-binary '{"jsonrpc": "2.0", "id": "curltest", "method": "getblockchaininfo", "params": []}' -H 'content-type: application/json' http://<raspberry_pi_ip>:8332/
```

```bash
$ curl --user test --data-binary '{"jsonrpc": "2.0", "id": "curltest", "method": "getblockchaininfo", "params": []}' -H 'content-type: application/json' http://192.168.0.112:8332/
{"jsonrpc":"2.0","result":{"chain":"main","blocks":915753,"headers":915753,"bestblockhash":"000000000000000000011aaa8e85e4831815b6f18340ef2d56ea3884a6301b30","bits":"1701fa38","target":"00000000000000000001fa380000000000000000000000000000000000000000","difficulty":142342602928674.9,"time":1758470427,"mediantime":1758466112,"verificationprogress":0.9999928627030699,"initialblockdownload":false,"chainwork":"0000000000000000000000000000000000000000e4b2f04f4c9fb655ba731930","size_on_disk":783353282429,"pruned":false,"warnings":[]},"id":"curltest"}
```

### connect sparrow wallet

1. Open sparrow wallet and go to settings
2. Click on "Server" tab

you view see

```
Server
Type: Bitcoin Core

Bitcoin CoreRPC
url: <ip_address>:<port> # your raspberry pi ip address
Authentication: User/Pass
User/Password: <username> <password> # your rpcuser and rpcpassword or rpcauth username and password
UseProxy: False
Proxy URl:
```

3. Click test connection you should see

```
Connected to Cormorant 2.1.3 on protocol version 1.4
Batched RPC enabled.
Server Banner: Cormorant 2.1.3
/Satoshi:29.0.0/
```
